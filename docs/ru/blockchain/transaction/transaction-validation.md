# Валидация транзакции

Каждая транзакция проходит проверку на валидность. В зависимости от результатов проверки транзакция может быть сохранена в блокчейне или отклонена.

## До активации фичи №&nbsp;17

1. Проверка временной метки транзакции.
   Временная метка транзакции отличается от временной метки текущего блока не более чем на 2 часа назад или 1,5 часа вперед.
2. Проверка версии транзакции.
   Активированы все фичи, необходимые для поддержки данной версии.
3. Проверка подписи транзакции для обычного аккаунта или верификация [скриптом аккаунта](/ru/ride/script/script-types/account-script) для смарт-аккаунта.
4. Верификация транзакции [скриптами ассетов](/ru/ride/script/script-types/asset-script), если в транзакции используются смарт-ассеты (за исключением смарт-ассетов в действиях скрипта, которые проверяются в п. 6).
5. Проверка баланса отправителя.
   Достаточно средств на оплату комиссии (если используется спонсорский ассет, проверяется также баланса спонсора).
   В зависимости от типа транзакции: достаточно средств для перевода и обмена ассетов, для выплаты платежей, приложенных к транзакции вызова скрипта.
6. Для транзакции вызова скрипта:
   * Выполнение dApp-скрипта.
   * Верификация [скриптами ассетов](/ru/ride/script/script-types/asset-script), если в [действиях скрипта](/ru/ride/structures/script-actions) используются смарт-ассеты.
   * Проверка баланса dApp: достаточно ли средств на выполнение [действий скрипта](/ru/ride/structures/script-actions).
   * Проверка баланса отправителя: достаточно ли средств на оплату дополнительной комиссии за действия скрипта.

Транзакция сохраняется в блокчейне и за нее взимается комиссия, если она успешно прошла все проверки.

## После активации фичи №&nbsp;17

Начиная с версии ноды 1.2.4, после активации фичи №&nbsp;17 “Accept transactions with failed script result” порядок валидации транзакций изменен. На данный момент версии 1.2.x доступны только на [Stagenet](/ru/blockchain/blockchain-network/stage-network).

1. Проверка временной метки транзакции.
2. Проверка версии транзакции.
3. Проверка баланса отправителя.
   Достаточно средств на оплату комиссии (если используется спонсорский ассет, проверяется также баланса спонсора).
   В зависимости от типа транзакции: достаточно средств для перевода и обмена ассетов, для выплаты платежей, приложенных к транзакции вызова скрипта.
4. Проверка подписи транзакции для обычного аккаунта или верификация [скриптом аккаунта](/ru/ride/script/script-types/account-script) для смарт-аккаунта.
5. Для транзакции вызова скрипта:
   * Выполнение dApp-скрипта.
   * Проверка баланса dApp: достаточно ли средств на выполнение [действий скрипта](/ru/ride/structures/script-actions).
   * Проверка баланса отправителя: достаточно ли средств на оплату дополнительной комиссии за действия скрипта.
6. Верификация транзакции [скриптами ассетов](/ru/ride/script/script-types/asset-script), если в транзакции используются смарт-асссеты, включая смарт-ассеты в [действиях скрипта](/ru/ride/structures/script-actions).

Транзакция вызова скрипта и транзакция обмена сохраняются в блокчейне и за них взимается комиссия при условии, они успешно прошли проверки 1—4. Если при этом проверки 5–6 не пройдены, транзакция сохраняется со статусом «невалидная» и не приводит к изменениям в балансах (кроме взимания комиссии с отправителя) и в хранилищах данных аккаунтов.

Транзакции остальных типов сохраняются в блокчейне и за них взимается комиссия, если они успешно прошли все проверки.

> :warning: После активации фичи №&nbsp;17 становится невозможной оплата комиссии за транзакцию вызова скрипта за счет средств, переведенных dApp-скриптом отправителю. Если баланс отправителя недостаточен для оплаты комиссии, dApp-скрипт не выполняется.
