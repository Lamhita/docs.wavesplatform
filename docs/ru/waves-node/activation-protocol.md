---
sidebarDepth: 2
---

# Протокол активации

## Фичи

Новая версия программного обеспечения Waves содержит новые фичи (features), которые должны быть активированы многими нодами одновременно.
Раньше функции активировались по временным отметкам, и это ставило владельцев нод в жесткие рамки по срокам проведения обновления. Неспособность обновить ноду вовремя приводила к непреднамеренным форкам. Протокол активации дает сообществу Waves возможность применять новые фичи в своем темпе или совсем не применять некоторые из них.
Подробнее про API методы, связанные с протоколом активации в статье [Activation](/ru/waves-node/node-api/feature-activation) главы [Node API](/ru/waves-node/node-api).

### Идентификация фич

Каждая новая фича имеет свой уникальный порядковый номер. Список новых фич с их идентификаторами обычно представлен в новом релизе.

Новые фичи поставляются с новыми версиями программного обеспечения ноды. До активации новых функций разные версии могут работать одинаково. После активации функции сеть делится две части: ноды, которые поддерживают эту функцию, и ноды, которые этого не делают.

### Статусы фич в блокчейне

Статус фичи хранится в блокчейне. Первоначальный статус фичи - `Voting`, которое затем можно изменить на `Approved` - это означает, что фича получила необходимое количество голосов от майнеров. По истечении определенного периода (количества блоков) фичи в статусе `Approved` получают статус `Activated`. С этого момента (блока) ноды, которые применили эту фичу, начинают работать по-новому.

## Голосование

Голосование осуществляется майнерами. Если майнер поддерживает фичу и хочет проголосовать за нее, он должен указать номер фичи (ID) в списке поддерживаемых фич в разделе `features` файла конфигурации. После этого каждый блок, сгенерированный этим майнером, будет содержать идентификаторы поддерживаемых фич. Подробнее о разделе `features` в файле конфигурации узла см. в секции [Features Settings](/ru/waves-node/node-configuration#features-section) статьи [Конфигурация ноды](/ru/waves-node/node-configuration).

Каждые 10000 блоков (это число может отличаться в других блокчейнах) нода суммирует количество блоков с поддержкой фичи. Если фича поддерживается в более чем 80% блоках в течение последнего расчетного периода, она становится утвержденной. В противном случае голосование продолжается и может занять другой период голосования (10 тыс. Блоков для Mainnet) или более.

Если нода видит, что новая фича была одобрена, но нода не реализует ее, она зарегистрирует предупреждающее сообщение о предстоящей активации неподдерживаемой функции.

Прежде чем утвержденная фича будет активирована, должны быть сгенерированы еще 10000 блоков. Этот период предназначен для обновления нод без майнинга до новой версии.

Если была активирована новая фича, но нода не была обновлена для ее поддержки, нода автоматически отключится (поведение по умолчанию) и зарегистрирует ошибку об активации неподдерживаемой фичи.

> :warning: В Testnet подтверждение и активация фичи занимают период в 3000 блоков каждый (100 блоков в Stagenet). Это позволяет быстрее активировать новые фичи для целей тестирования.

## Пример

Допустим, в версии 1.0.0 была введена новая интересующая нас фича, её ID равен `123`.

Майнинг пул `SuperMiners` с общей долей владения 40% поддерживает фичу. Администратор `SuperMiners` обновляет ноду с версии 0.9.9 до 1.0.0 и добавляет `123` в список поддерживаемых фич в конфиге. Нода `SuperMiners` начинает добавлять ID равный `123` в каждый сгенерированный блок, начиная с высоты 1228765. Другие майнеры не поддержали фичу и только некоторые из них обновили ноды до версии 1.0.0.

На блоке номер 1230000 ноды посчитали, что только 50% блоков поддерживают фичу `123`. Таким образом, статус фичи остается неизменным, голосование за этот период не увенчалось успехом, и, следовательно, продолжается.

В течение следующих 10000 блоков `SuperMiners` убедили некоторых майнеров поменьше поддержать эту фичу. На блоке 1240000 оказывается, что функция поддерживается в 9102 из последних 10000 блоков, то есть в 91%. Таким образом, статус фичи изменился на одобренный. В данный момент ноды, работающие на версии 0.9.9 и на более ранних, предупреждают своих владельцев об утверждении неподдерживаемой фичи.

На момент генерации 1250000 блока фича `123` будет активирована и её начнут использовать ноды версии 1.0.0 и выше.
Ноды более ранних версий перестанут работать.
